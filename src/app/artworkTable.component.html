<paNavBar></paNavBar>
<div style="width: 100%; background-color: white;" class="border pl-3 pr-3">
<p class="lead">{{configSettings.artworks_para1}}</p>
<div *ngIf="isLoggedIn()" class="form-group">
    <div class="bg-white text-black pl-1 pt-1 border-top-0 border-left-0 border-right-0" style="border-width: 2px; border-style: solid;">
        <strong>My pipe organ collection</strong>
    </div>
    <div class="form-group" *ngIf="getArtworks().length > 12">
        <div class="row pt-1">
            <div class="col-sm-2 pt-1" style="min-width: 12em;">
               <label for="search-text">Filter my collection:</label>
            </div>
            <div class="col-sm">
                <input type="email" class="form-control" id="search-text" aria-describedby="search-text" 
                [(ngModel)]="searchText" placeholder="Organ or builder">
            </div>
        </div>
    </div>
    <div class="row itemsBlock pt-2">
        <div *ngFor="let item of getArtworks() | appFilter: searchText; let i = index" class="col-md-4 col-sm-6 col-12 pb-3">
            <div class="row pb-3">
                <div class="col-12">
                    <img src="{{item.url}}" alt="{{item.name}}" height="auto" style="width:100%" (error)="handleMissingImage($event)">
                </div>
                <div class="col-12 ml-1">
                    <div class="col-12">
                        <div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;" [innerHTML]="item.name"></div>
                        <strong><div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;" [innerHTML]="item.artist"></div></strong>
                        <div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;">{{item.year}}</div>
                    </div>
                </div>
                <div class="col-12" *ngIf="deleteConfirmation_Id!=item._id">
                    <button class="float-right btn btn-danger"  (click)="confirmDelete(item._id)">Delete</button>
                </div>
        
                <span *ngIf="deleteConfirmation_Id==item._id">
                    <div class="alert alert-danger" role="alert"><strong>Are you sure you want to delete this organ from your collection?</strong>
                    <span *ngIf="getScriptsOfAnArtwork(item._id).length > 0">
                        <p><strong>It will be removed from the following paths:</strong></p>
                    </span>
                    <ul *ngIf="getScriptsOfAnArtwork(item._id).length > 0">
                        <li *ngFor="let artworkscript of getScriptsOfAnArtwork(item._id);">{{artworkscript.name}}</li>
                    </ul>
                    <!-- <ul *ngFor="let artworkscript of getScriptsOfAnArtwork(item._id);">
                        <li>{{artworkscript.name}}</li>
                    </ul> -->
                    <div class="text-end">
                        <button class="btn btn-secondary" (click)="deleteConfirmation_Id=''">Cancel</button><button class="btn btn-danger ml-2" (click)="deleteArtwork(item._id)">OK</button></div>
                    </div>
                </span>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="ng-autocomplete" style="width: 100%;">
            <span><strong>{{configSettings.artworks_searchprompt}}</strong></span>
            <ng-autocomplete 
            [data]="data"
            [searchKeyword]="keyword"
            (selected)='selectEvent($event)'
            (inputChanged)='onChangeSearch($event)'
            (inputFocused)='onFocused($event)'
            [itemTemplate]="itemTemplate"
            [notFoundTemplate]="notFoundTemplate"
            [placeholder]="placeholderText"
            [historyListMaxNumber]="15"
            [minQueryLength]="2">                                 
            </ng-autocomplete>
        
            <ng-template #itemTemplate let-item>
                <a href="javascript:void(0)">
                    <span [innerHTML]="item.searchstring"></span>
                </a>
            </ng-template>
            
            <ng-template #notFoundTemplate let-notFound>
            <div [innerHTML]="notFound"></div>
            </ng-template>
        </div>
    </div>
    <div *ngIf="selected" class="pb-3">
        <div class="row align-items-end mb-3">
            <div class="col-md-4 col-sm-6">
                <img src="{{selectedURL()}}" alt="{{selectedName()}}" height="auto" style="width:100%" (error)="handleMissingImage($event)">
            </div>
            <div class="col-sm ml-3">
                <div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;" [innerHTML]="selectedName()"></div>
                <strong><div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;" [innerHTML]="selectedArtist()"></div></strong>
                <div class="row text-left" style="white-space: pre-wrap; line-height: 1.2;" [innerHTML]="selectedYear()"></div>
            </div>

            <div class="col-sm">
                <button class="float-right btn btn-success" (click)="saveArtwork(); selected=false;">Add</button>
            </div>
        </div>
        <div style="width:100%" class="bg-light mt-2 mb-2">
        <div class="row">
            <div class="col-12">
                <button class="btn btn-dark float-right"
                (click)="hideBuildHistory = !hideBuildHistory"
                [attr.aria-expanded]="!hideBuildHistory"
                aria-controls="collapseExample"><i class="fa fa-info"></i> Build history</button>
            </div>
        </div>
        <div [ngbCollapse]="hideBuildHistory" class="collapse navbar-collapse mt-2" *ngIf="getDBBuildHistory().length">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Year</th>
                        <th scope="col">Builder</th>
                        <th scope="col">Tasks</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of getDBBuildHistory();">
                        <td>{{item.year}}</td>
                        <td>{{item.builder}}</td>
                        <td>
                            <ng-container *ngFor="let task of splitTextOnSeparator(item.tasks);">
                                {{task}}<br/>
                            </ng-container>
                        </td>
                    </tr>
                </tbody>
            </table>
		</div>
        </div>
        <div style="width:100%" class="bg-light mt-2 mb-2">
        <div class="row">
            <div class="col-12">
                <button class="btn btn-dark float-right"
                (click)="hideDispositionHistory = !hideDispositionHistory"
                [attr.aria-expanded]="!hideDispositionHistory"
                aria-controls="collapseExample"><i class="fa fa-info"></i> Disposition</button>
            </div>
        </div>
        <div [ngbCollapse]="hideDispositionHistory" class="collapse navbar-collapse mt-2"  *ngIf="getDBDispositionInfo().length">
            <!-- <div class="row" style="display: inline-block; vertical-align: top; width: 100%;"> -->
                <div *ngFor="let disposition of getDBDispositionInfo().slice(0,2); let i = index" class="col-6" style="display: inline-block; vertical-align: top;">
                    <ng-container *ngIf="getDBDispositionInfo().length == 1">
                        <p class="lh-sm">{{getDBDispositionInfo()[0].parthoodname}}</p>
                    </ng-container>
                    <ng-container *ngIf="getDBDispositionInfo().length > 1">
                        <select class="form-select bg-light" aria-label="Default select example" [(ngModel)]="dispositionSelection[i]">
                            <ng-container *ngFor="let d of getDBDispositionInfo(); let j = index">
                                <option [ngValue]="j">{{d.parthoodname}}</option>
                            </ng-container>
                        </select>
                    </ng-container>
                    <ng-container *ngFor="let division of getDBDispositionInfo()[dispositionSelection[i]].divisions">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col" colspan="2">
                                        {{division.divisionname}}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let stop of division.stops">
                                    <td>{{stop.stopname}}</td>
                                    <td>{{stop.stopspecification}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </ng-container>
                </div>
            <!-- </div> -->
        </div>
        </div>
    </div>
    <br/>
    <br/>
    <br/>
</div>
</div>
<br/>
<br/>
<br/>
<br/>


