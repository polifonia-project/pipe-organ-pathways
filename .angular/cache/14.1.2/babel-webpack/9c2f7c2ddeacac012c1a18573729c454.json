{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./currentUser.service\";\nimport * as i2 from \"./repository.model\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"angular-ng-autocomplete\";\nimport * as i5 from \"./navBar.component\";\n\nfunction ArtworkTableComponent_div_3_tr_8_span_12_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\")(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3, \"It will be removed from the following scripts:\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction ArtworkTableComponent_div_3_tr_8_span_12_ul_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\")(1, \"li\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const artworkscript_r14 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(artworkscript_r14.name);\n  }\n}\n\nfunction ArtworkTableComponent_div_3_tr_8_span_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\")(1, \"div\", 16)(2, \"strong\");\n    i0.ɵɵtext(3, \"Are you sure you want to delete this artwork from your collection?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ArtworkTableComponent_div_3_tr_8_span_12_span_4_Template, 4, 0, \"span\", 7);\n    i0.ɵɵtemplate(5, ArtworkTableComponent_div_3_tr_8_span_12_ul_5_Template, 3, 1, \"ul\", 6);\n    i0.ɵɵelementStart(6, \"div\")(7, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function ArtworkTableComponent_div_3_tr_8_span_12_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const item_r9 = i0.ɵɵnextContext().$implicit;\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r15.deleteArtwork(item_r9._id));\n    });\n    i0.ɵɵtext(8, \"OK\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ArtworkTableComponent_div_3_tr_8_span_12_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r18 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r18.deleteConfirmation_Id = \"\");\n    });\n    i0.ɵɵtext(10, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const item_r9 = i0.ɵɵnextContext().$implicit;\n    const ctx_r11 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r11.getScriptsOfAnArtwork(item_r9._id).length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r11.getScriptsOfAnArtwork(item_r9._id));\n  }\n}\n\nfunction ArtworkTableComponent_div_3_tr_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"a\", 12);\n    i0.ɵɵelement(3, \"img\", 13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"td\")(5, \"div\")(6, \"strong\");\n    i0.ɵɵelement(7, \"span\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"br\")(9, \"span\", 14)(10, \"br\");\n    i0.ɵɵtext(11);\n    i0.ɵɵtemplate(12, ArtworkTableComponent_div_3_tr_8_span_12_Template, 11, 2, \"span\", 7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"td\")(14, \"div\")(15, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function ArtworkTableComponent_div_3_tr_8_Template_button_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r21);\n      const item_r9 = restoredCtx.$implicit;\n      const ctx_r20 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r20.confirmDelete(item_r9._id));\n    });\n    i0.ɵɵtext(16, \"Delete\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const item_r9 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"href\", item_r9.url, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", item_r9.url, i0.ɵɵsanitizeUrl);\n    i0.ɵɵpropertyInterpolate(\"alt\", item_r9.name);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"innerHTML\", item_r9.name, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", item_r9.artist, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r9.year, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.deleteConfirmation_Id == item_r9._id);\n  }\n}\n\nfunction ArtworkTableComponent_div_3_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 13);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r2.selectedURL(), i0.ɵɵsanitizeUrl);\n    i0.ɵɵpropertyInterpolate(\"alt\", ctx_r2.selectedName());\n  }\n}\n\nfunction ArtworkTableComponent_div_3_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"strong\");\n    i0.ɵɵelement(2, \"span\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"br\")(4, \"span\", 14)(5, \"br\")(6, \"span\", 14);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r3.selectedName(), i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r3.selectedArtist(), i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r3.selectedYear(), i0.ɵɵsanitizeHtml);\n  }\n}\n\nfunction ArtworkTableComponent_div_3_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function ArtworkTableComponent_div_3_div_15_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r22 = i0.ɵɵnextContext(2);\n      ctx_r22.saveArtwork();\n      return i0.ɵɵresetView(ctx_r22.selected = false);\n    });\n    i0.ɵɵtext(2, \"Add\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ArtworkTableComponent_div_3_ng_template_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 20);\n    i0.ɵɵelement(1, \"span\", 21);\n    i0.ɵɵtext(2, \", \");\n    i0.ɵɵelement(3, \"span\", 21);\n    i0.ɵɵtext(4, \", \");\n    i0.ɵɵelement(5, \"span\", 21);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r24 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"innerHTML\", item_r24.name, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", item_r24.artist, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", item_r24.year, i0.ɵɵsanitizeHtml);\n  }\n}\n\nfunction ArtworkTableComponent_div_3_ng_template_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 21);\n  }\n\n  if (rf & 2) {\n    const notFound_r25 = ctx.$implicit;\n    i0.ɵɵproperty(\"innerHTML\", notFound_r25, i0.ɵɵsanitizeHtml);\n  }\n}\n\nfunction ArtworkTableComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"table\", 3)(2, \"thead\", 4)(3, \"tr\")(4, \"th\", 5);\n    i0.ɵɵtext(5, \"My artworks\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"th\")(7, \"th\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(8, ArtworkTableComponent_div_3_tr_8_Template, 17, 7, \"tr\", 6);\n    i0.ɵɵelementStart(9, \"tr\")(10, \"td\");\n    i0.ɵɵtemplate(11, ArtworkTableComponent_div_3_div_11_Template, 2, 2, \"div\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtemplate(13, ArtworkTableComponent_div_3_div_13_Template, 7, 3, \"div\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtemplate(15, ArtworkTableComponent_div_3_div_15_Template, 3, 0, \"div\", 7);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(16, \"div\", 8)(17, \"span\");\n    i0.ɵɵtext(18, \"Search IMMA collection:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"ng-autocomplete\", 9);\n    i0.ɵɵlistener(\"selected\", function ArtworkTableComponent_div_3_Template_ng_autocomplete_selected_19_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r26.selectEvent($event));\n    })(\"inputChanged\", function ArtworkTableComponent_div_3_Template_ng_autocomplete_inputChanged_19_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.onChangeSearch($event));\n    })(\"inputFocused\", function ArtworkTableComponent_div_3_Template_ng_autocomplete_inputFocused_19_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r29 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r29.onFocused($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(20, ArtworkTableComponent_div_3_ng_template_20_Template, 6, 3, \"ng-template\", null, 10, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtemplate(22, ArtworkTableComponent_div_3_ng_template_22_Template, 1, 1, \"ng-template\", null, 11, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(24, \"br\")(25, \"br\")(26, \"br\")(27, \"br\")(28, \"br\")(29, \"br\")(30, \"br\")(31, \"br\")(32, \"br\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const _r5 = i0.ɵɵreference(21);\n\n    const _r7 = i0.ɵɵreference(23);\n\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.getArtworks());\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.selected);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r0.data)(\"searchKeyword\", ctx_r0.keyword)(\"itemTemplate\", _r5)(\"notFoundTemplate\", _r7)(\"placeholder\", ctx_r0.placeholderText)(\"historyListMaxNumber\", 15)(\"minQueryLength\", 2);\n  }\n}\n\nexport let ArtworkTableComponent = /*#__PURE__*/(() => {\n  class ArtworkTableComponent {\n    constructor(currentuser, model) {\n      this.currentuser = currentuser;\n      this.model = model;\n      this.deleteConfirmation_Id = \"\";\n      this.placeholderText = \"Artwork, artist or year\";\n      this.selected = false;\n      this.selectItem = [];\n      this.keyword = 'searchstring';\n      this.data = this.model.getCollection();\n    }\n\n    confirmDelete(_id) {\n      this.deleteConfirmation_Id = _id;\n    }\n\n    selectedArtworkLabel() {\n      return this.selectItem[\"name\"] + \", \" + this.selectItem[\"artist\"] + \", \" + this.selectItem[\"year\"];\n    }\n\n    selectedName() {\n      return this.selectItem[\"name\"];\n    }\n\n    selectedArtist() {\n      return this.selectItem[\"artist\"];\n    }\n\n    selectedYear() {\n      return this.selectItem[\"year\"];\n    }\n\n    selectedURL() {\n      return this.selectItem[\"filelocation\"];\n    } // data for testing\n    // data = [\n    //     {name: \"Jacob’s Dream\", artist: \"Patrick Hall\", year: \"2002\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/1551.jpg\"},\n    //     {name: \"Tarot Set\", artist: \"Ulla von Brandenburg\", year: \"2008\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/2260.jpg\"},\n    //     {name: \"Patrick Hall\", artist: \"Nick Miller\", year: \"1994\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/487.jpg\"},\n    //     {name: \"Burning Tree\", artist: \"Patrick Hall\", year: \"2006\", filelocation: \"https://imma.ie/wp-content/uploads/2021/03/33.jpg\"},\n    //     {name: \"Sphère-Trame\", artist: \"François Morellet\", year: \"1962\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/1989.jpg\"},\n    //     {name: \"Ancestors\", artist: \"Patrick Hall\", year: \"1991\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/911.jpg\"},\n    //     {name: \"Rising of Faust\", artist: \"Patrick Hall\", year: \"1996\", filelocation: \"https://imma.ie/wp-content/uploads/2018/11/1066.jpg\"}\n    // ];\n\n\n    selectEvent(item) {\n      this.reloadArtworks(); // do something with selected item\n\n      this.selected = true;\n      this.selectItem = item;\n    }\n\n    onChangeSearch(val) {// fetch remote data from here\n      // And reassign the 'data' which is binded to 'data' property.\n    }\n\n    onFocused(e) {// do something when input is focused\n    }\n\n    getArtworks() {\n      let artworks = this.model.getArtworks(); // filter artworks for login\n\n      let filteredArtworks = this.filterArtworksForLogin(artworks);\n      let sortedArtworks = filteredArtworks.sort((a, b) => a.artist < b.artist ? -1 : 1);\n      return sortedArtworks;\n    }\n\n    filterArtworksForLogin(artworks) {\n      let user = this.currentuser.getUser();\n      let userID = user.id;\n\n      if (userID == 0) {\n        return [];\n      }\n\n      let filteredArtworks = artworks.filter(x => x.owner == user._id);\n      return filteredArtworks;\n    }\n\n    saveArtwork() {\n      let artwork = {\n        type: \"artwork\",\n        name: this.selectItem[\"name\"],\n        artist: this.selectItem[\"artist\"],\n        year: this.selectItem[\"year\"],\n        url: this.selectItem[\"filelocation\"]\n      }; //add current user_ID as owner\n\n      let user_ID = this.currentuser.getUser()._id;\n\n      artwork.owner = user_ID;\n      let currentArtworksOfLogin = this.getArtworks();\n\n      if (!currentArtworksOfLogin.find(x => x.owner == artwork.owner && x.url == artwork.url)) {\n        this.model.saveArtwork(artwork);\n      }\n    }\n\n    deleteArtwork(_id) {\n      //delete artwork from scripts\n      let scripts = this.model.getScriptsOfAnArtwork(_id);\n      this.model.removeArtworkFromScripts(scripts, _id); //delete artwork\n\n      this.model.deleteArtwork(_id);\n    }\n\n    isLoggedIn() {\n      return this.currentuser.getUserID() != undefined;\n    }\n\n    reloadArtworks() {\n      this.model.refreshArtworks();\n    }\n\n    getScriptsOfAnArtwork(_id) {\n      return this.model.getScriptsOfAnArtwork(_id);\n    }\n\n  }\n\n  ArtworkTableComponent.ɵfac = function ArtworkTableComponent_Factory(t) {\n    return new (t || ArtworkTableComponent)(i0.ɵɵdirectiveInject(i1.CurrentUser), i0.ɵɵdirectiveInject(i2.Model));\n  };\n\n  ArtworkTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ArtworkTableComponent,\n    selectors: [[\"paArtworkTable\"]],\n    decls: 4,\n    vars: 1,\n    consts: [[1, \"lead\"], [\"class\", \"form-group\", 4, \"ngIf\"], [1, \"form-group\"], [1, \"table\", \"table-sm\", \"table-striped\"], [1, \"thead-dark\"], [\"width\", \"20%\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"ng-autocomplete\", \"mb-5\"], [3, \"data\", \"searchKeyword\", \"itemTemplate\", \"notFoundTemplate\", \"placeholder\", \"historyListMaxNumber\", \"minQueryLength\", \"selected\", \"inputChanged\", \"inputFocused\"], [\"itemTemplate\", \"\"], [\"notFoundTemplate\", \"\"], [\"target\", \"_blank\", 3, \"href\"], [\"height\", \"auto\", \"width\", \"150px\", 1, \"img-thumbnail\", 3, \"src\", \"alt\"], [2, \"white-space\", \"pre-wrap\", 3, \"innerHTML\"], [1, \"btn\", \"btn-danger\", 3, \"click\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\"], [1, \"btn\", \"btn-danger\", \"ml-2\", 3, \"click\"], [1, \"btn\", \"btn-secondary\", \"ml-2\", 3, \"click\"], [1, \"btn\", \"btn-success\", 3, \"click\"], [\"href\", \"javascript:void(0)\"], [3, \"innerHTML\"]],\n    template: function ArtworkTableComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"paNavBar\");\n        i0.ɵɵelementStart(1, \"p\", 0);\n        i0.ɵɵtext(2, \"Manage the collection of artworks that can be used in your scripts.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(3, ArtworkTableComponent_div_3_Template, 33, 11, \"div\", 1);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn());\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf, i4.AutocompleteComponent, i5.NavBarComponent],\n    encapsulation: 2\n  });\n  return ArtworkTableComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}